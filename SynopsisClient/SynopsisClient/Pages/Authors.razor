@page "/authors"
@inject SynopsisClient.Model.SynopsisHandler Handler
@inject SynopsisClient.Model.UserManager UserManager
@inject NavigationManager Nav

<h2>Authors</h2>

@if (Handler.Synopsis == null
    || Handler.IsReloading)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="intro">

        <p>You have already entered your information when you submitted the form. You can also define additional authors.</p>

        <p>Please follow the rules:</p>

        <ul style="font-weight: bold;">
            <li>You need to define at least one author!</li>
            <li>Each author must have every field filled.</li>
        </ul>

    </div>

    <EditForm EditContext="@Handler.CurrentEditContext">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <ConfirmDialog Title="Are you sure?"
                       ShowDialog="Handler.ShowConfirmDeleteItemDialog"
                       OkText="Yes"
                       CancelText="No"
                       OnOkCancelClicked="Handler.DeletItemConfirmationOkCancelClicked">
            <em>Note:</em> You can cancel your local changes by reloading the page <strong>BEFORE</strong> saving.
            <br />
            You can also reload the unchanged synopsis from the cloud.
        </ConfirmDialog>

        <ConfirmDialog Title="Are you sure?"
                       ShowDialog="Handler.ShowConfirmReloadFromCloudDialog"
                       OkText="Yes"
                       CancelText="No"
                       OnOkCancelClicked="Handler.ReloadFromCloudConfirmationOkCancelClicked">
            <strong style="color:red ">Caution:</strong> If you click yes, you will lose <strong>all</strong> your local changes.
        </ConfirmDialog>

        <div class="edit-area">

            @foreach (var author in Handler.Synopsis.Authors)
            {
                <div>
                    <label title="Author's name">
                        <span class="form-label">Author name</span>
                        <br />
                        <InputText class="short-input"
                                    @bind-Value="author.Name" />
                    </label>
                    <label title="Author's Email address">
                        <span class="form-label">Email</span>
                        <br />
                        <InputText class="short-input"
                                    @bind-Value="author.Email" />
                    </label>
                    <label title="Author's GitHub username">
                        <span class="form-label">GitHub</span>
                        <br />
                        <InputText class="short-input"
                                    @bind-Value="author.GitHub" />
                    </label>
                    <label title="Author's Twitter username">
                        <span class="form-label">Twitter</span>
                        <br />
                        <InputText class="short-input"
                                    @bind-Value="author.Twitter" />
                    </label>
                    <br />
                    <button class="small-button"
                            @onclick="(e => Handler.Delete(author))">
                        Delete
                    </button>
                </div>

                <hr />
            }
        </div>

        <div class="bottom-buttons-area">
            <button class="main-button"
                    @onclick="Handler.AddItem">
                Add an author
            </button>
        </div>

        <div class="bottom-buttons-area">
            <button disabled="@Handler.CannotSave"
                    class="main-button"
                    @onclick="Handler.CheckSaveSynopsis">
                Save local
            </button>
            <button class="main-button"
                    @onclick="Handler.ReloadFromCloud">
                Reload from cloud
            </button>
        </div>

    </EditForm>
}
